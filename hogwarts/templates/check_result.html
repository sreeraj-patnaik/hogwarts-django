{% extends "base.html" %}
{% load static %}

{% block content %}
<div style="max-width:900px; margin:30px auto; font-family:Arial, sans-serif;">
    <div style="text-align:center; background:#003185; color:white; padding:20px; border-radius:8px; box-shadow:0 4px 8px rgba(0,0,0,0.1);">
        <h1>Student Results Portal</h1>
        <p style="font-size:1.1rem;">Check semester-wise results and GPA</p>
    </div>

    <div style="background:#f5f5f5; padding:20px; margin-top:20px; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,0.05);">
        <form method="post" style="display:flex; flex-wrap:wrap; gap:15px; align-items:flex-end;">
            {% csrf_token %}
            <div style="flex:1 1 200px;">
                <label for="roll_number" style="font-weight:bold;">Roll Number:</label><br>
                <input type="text" id="roll_number" name="roll_number" required style="width:100%; padding:8px; border-radius:4px; border:1px solid #ccc;">
            </div>

            <div style="flex:1 1 200px;">
                <label for="semester" style="font-weight:bold;">Semester:</label><br>
                <select id="semester" name="semester" required style="width:100%; padding:8px; border-radius:4px; border:1px solid #ccc;">
                    <option value="">Select Semester</option>
                    {% for i in semesters %}
                        <option value="{{ i }}" {% if sem == i %}selected{% endif %}>Semester {{ i }}</option>
                    {% endfor %}
                </select>
            </div>

            <div>
                <button type="submit" style="background:#3777ed; color:white; padding:10px 20px; border:none; border-radius:6px; cursor:pointer; font-weight:bold;">
                    Check
                </button>
            </div>
        </form>
    </div>

    {% if student %}
    <div style="margin-top:30px; display:flex; gap:20px; background:white; padding:20px; border-radius:8px; box-shadow:0 4px 10px rgba(0,0,0,0.05);">
        <div style="flex:0 0 150px;">
            {% if student.photo %}
                <img src="{{ student.photo.url }}" alt="Photo of {{ student.full_name }}" style="width:150px; height:180px; object-fit:cover; border:1px solid #ccc; border-radius:4px;">
            {% else %}
                <div style="width:150px; height:180px; background:#ddd; display:flex; align-items:center; justify-content:center; color:#555; font-weight:bold; border-radius:4px;">
                    No Photo
                </div>
            {% endif %}
        </div>

        <div style="flex:1;">
            <h2 style="margin-top:0;">{{ student.full_name }}</h2>
            <p><strong>Roll Number:</strong> {{ student.roll_number }}</p>
            <p><strong>House:</strong> {{ student.get_house_display }}</p>
            <p><strong>Year:</strong> {{ student.year }}</p>
            <p><strong>Blood Status:</strong> {{ student.get_blood_status_display }}</p>

            {% if semester_results %}
            <div style="margin-top:15px; overflow-x:auto;">
                <table style="width:100%; border-collapse:collapse; text-align:left;">
                    <thead style="background:#003185; color:white;">
                        <tr>
                            <th style="padding:8px; border:1px solid #ccc;">Subject</th>
                            <th style="padding:8px; border:1px solid #ccc;">Grade</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for r in semester_results %}
                        <tr style="background:#f9f9f9;">
                            <td style="padding:8px; border:1px solid #ccc;">{{ r.subject }}</td>
                            <td style="padding:8px; border:1px solid #ccc;">{{ r.grade }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>

            <div style="margin-top:15px; padding:15px; background:#e8f0fe; border-radius:6px;">
                <p style="margin:5px 0;"><strong>SGPA:</strong> {{ sgpa }}</p>
                <p style="margin:5px 0;"><strong>CGPA:</strong> {{ cgpa }}</p>
            </div>
            {% else %}
            <p style="margin-top:10px; color:red; font-weight:bold;">No subjects found for Semester {{ sem }}.</p>
            {% endif %}
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}
